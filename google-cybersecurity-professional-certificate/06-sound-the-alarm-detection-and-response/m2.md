- [The importance of network traffic flows](#the-importance-of-network-traffic-flows)
  - [Indicators of compromise (IOC)](#indicators-of-compromise-ioc)
  - [Data exfiltration](#data-exfiltration)
- [Maintain awareness with network monitoring](#maintain-awareness-with-network-monitoring)
  - [Know your network](#know-your-network)
  - [Monitor your network](#monitor-your-network)
    - [Flow analysis](#flow-analysis)
    - [Packet payload information](#packet-payload-information)
    - [Temporal patterns](#temporal-patterns)
  - [Protect your network](#protect-your-network)
    - [Network monitoring tools](#network-monitoring-tools)
  - [Resources](#resources)
- [Learn more about packet captures](#learn-more-about-packet-captures)
  - [Packets](#packets)
    - [Header](#header)
    - [Payload](#payload)
    - [Footer](#footer)
  - [Network protocol analyzers](#network-protocol-analyzers)
    - [How network protocol analyzers work](#how-network-protocol-analyzers-work)
    - [Capturing packets](#capturing-packets)
  - [Resources for more information](#resources-for-more-information)
- [Investigate packet details](#investigate-packet-details)
  - [Internet Protocol (IP)](#internet-protocol-ip)
    - [IPv4](#ipv4)
    - [IPv6](#ipv6)
  - [Wireshark](#wireshark)
    - [Display filters](#display-filters)
    - [Comparison operators](#comparison-operators)
    - [Contains operator](#contains-operator)
    - [Matches operator](#matches-operator)
  - [Filter toolbar](#filter-toolbar)
    - [Filter for protocols](#filter-for-protocols)
    - [Filter for an IP address](#filter-for-an-ip-address)
    - [Filter for a MAC address](#filter-for-a-mac-address)
    - [Filter for ports](#filter-for-ports)
  - [Follow streams](#follow-streams)
  - [Resources](#resources-1)
- [Analyze your first packet](#analyze-your-first-packet)
  - [Activity overview](#activity-overview)
  - [Scenario](#scenario)
  - [Task 1. Explore data with Wireshark](#task-1-explore-data-with-wireshark)
  - [Task 2. Apply a basic Wireshark filter and inspect a packet](#task-2-apply-a-basic-wireshark-filter-and-inspect-a-packet)
  - [Task 3. Use filters to select packets](#task-3-use-filters-to-select-packets)
  - [Task 4. Use filters to explore DNS packets](#task-4-use-filters-to-explore-dns-packets)
  - [Task 5. Use filters to explore TCP packets](#task-5-use-filters-to-explore-tcp-packets)
- [Overview of tcpdump](#overview-of-tcpdump)
  - [What is tcpdump?](#what-is-tcpdump)
  - [Capturing packets with tcpdump](#capturing-packets-with-tcpdump)
  - [Options](#options)
    - [`-w`](#-w)
    - [`-r`](#-r)
    - [`-v`](#-v)
    - [`-c`](#-c)
    - [`-n`](#-n)
  - [Expressions](#expressions)
  - [Interpreting output](#interpreting-output)
  - [Resources for more information](#resources-for-more-information-1)
- [Capture your first packet](#capture-your-first-packet)
  - [Activity overview](#activity-overview-1)
  - [Scenario](#scenario-1)
  - [Task 1. Identify network interfaces](#task-1-identify-network-interfaces)
  - [Task 2. Inspect the network traffic of a network interface with tcpdump](#task-2-inspect-the-network-traffic-of-a-network-interface-with-tcpdump)
    - [Exploring network packet details](#exploring-network-packet-details)
  - [Task 3. Capture network traffic with tcpdump](#task-3-capture-network-traffic-with-tcpdump)
  - [Task 4. Filter the captured packet data](#task-4-filter-the-captured-packet-data)
  - [Test your understanding](#test-your-understanding)
- [Research network protocol analyzers](#research-network-protocol-analyzers)
  - [Activity Overview](#activity-overview-2)
  - [Scenario](#scenario-2)
  - [Step-By-Step Instructions](#step-by-step-instructions)
    - [Step 1: Access the template](#step-1-access-the-template)
    - [Step 2: Conduct online research](#step-2-conduct-online-research)
    - [Step 3: Fill in the diagram](#step-3-fill-in-the-diagram)
    - [Pro Tip: Save the template](#pro-tip-save-the-template)
    - [What to Include in Your Response](#what-to-include-in-your-response)
  - [Activity Exemplar](#activity-exemplar)
- [Quiz: Module 2 Challenge](#quiz-module-2-challenge)
  - [Questions Set 1](#questions-set-1)
  - [Answers Set 1](#answers-set-1)
  - [Questions Set 2](#questions-set-2)
  - [Answers Set 2](#answers-set-2)

# The importance of network traffic flows

## Indicators of compromise (IOC)

Observable evidence that suggests signs of a potential security incident.

## Data exfiltration

Unauthorized transmission of data from a system.

Defensive measures

1. Prevent attacker access
2. Monitor network activity
3. Protect assets
4. Detect and stop the exfiltration

# Maintain awareness with network monitoring

Network communication can be noisy! Events like sending an email, streaming a video, or visiting a website all produce network communications in the form of network traffic and network data. As a reminder, network traffic is the amount of data that moves across a network. It can also include the type of data that is transferred, such as HTTP. Network data is the data that's transmitted between devices on a network.

Network monitoring is essential in maintaining situational awareness of any activity on a network. By collecting and analyzing network traffic, organizations can detect suspicious network activity. But before networks can be monitored, you must know exactly what to monitor.

## Know your network

As you’ve learned, networks connect devices, and devices then communicate and exchange data using network protocols. Network communications provide information about connections such as source and destination IP addresses, amount of data transferred, date and time, and more. This information can be valuable for security professionals when developing a baseline of normal or expected behavior.

![baseline](/google-cybersecurity-professional-certificate/06-sound-the-alarm-detection-and-response/assets/baseline.png)

A baseline is a reference point that’s used for comparison. You've probably encountered or used baselines at some point. For example, a grocery amount for a personal budget is an example of a baseline that can be used to help identify any patterns or changes in spending habits. In security, baselines help establish a standard of expected or normal behavior for systems, devices, and networks. Essentially, by knowing the baseline of normal network behavior, you'll be better able to identify _abnormal network_ behavior.

## Monitor your network

Once you’ve determined a baseline, you can monitor a network to identify any deviations from that baseline. Monitoring involves examining network components to detect unusual activities, such as large and unusual data transfers. Here are examples of network components that can be monitored to detect malicious activity:

### Flow analysis

Flow refers to the movement of network communications and includes information related to packets, protocols, and ports. Packets can travel to ports, which receive and transmit communications. Ports are often, but not always, associated with network protocols. For example, port 443 is commonly used by HTTPS which is a protocol that provides website traffic encryption.

However, malicious actors can use protocols and ports that are not commonly associated to maintain communications between the compromised system and their own machine. These communications are what’s known as **command and control (C2)**, which are the techniques used by malicious actors to maintain communications with compromised systems.

For example, malicious actors can use HTTPS protocol over port 8088 as opposed to its commonly associated port 443 to communicate with compromised systems. Organizations must know which ports should be open and approved for connections, and watch out for any mismatches between ports and their associated protocols.

### Packet payload information

Network packets contain components related to the transmission of the packet. This includes details like source and destination IP address, and the packet payload information, which is the actual data that’s transmitted. Often, this data is encrypted and requires decryption for it to be readable. Organizations can monitor the payload information of packets to uncover unusual activity, such as sensitive data transmitting outside of the network, which could indicate a possible data exfiltration attack.

### Temporal patterns

Network packets contain information relating to time. This information is useful in understanding time patterns. For example, a company operating in North America experiences bulk traffic flows between 9 a.m. to 5 p.m., which is the baseline of normal network activity. If large volumes of traffic are suddenly outside of the normal hours of network activity, then this is considered off baseline and should be investigated.

Through network monitoring, organizations can promptly detect network intrusions and work to prevent them from happening by securing network components.

## Protect your network

In this program, you’ve learned about **security operations centers (SOC)** and their role in monitoring systems against security threats and attacks. Organizations may deploy a **network operations center (NOC)**, which is an organizational unit that monitors the performance of a network and responds to any network disruption, such as a network outage. While a SOC is focused on maintaining the security of an organization through detection and response, a NOC is responsible for maintaining network performance, availability, and uptime.

Security analysts monitor networks to identify any signs of potential security incidents known as **indicators of compromise (IoC)** and protect networks from threats or attacks. To do this, they must understand the environment that network communications travel through so that they can identify deviations in network traffic.

### Network monitoring tools

Network monitoring can be automated or performed manually. Some common network monitoring tools can include:

- **Intrusion detection systems (IDS)** monitor system activity and alert on possible intrusions. An IDS will detect and alert on the deviations you’ve configured it to detect. Most commonly, IDS tools will monitor the content of packet payload to detect patterns associated with threats such as malware or phishing attempts.

- **Network protocol analyzers**, also known as packet sniffers, are tools designed to capture and analyze data traffic within a network. They can be used to analyze network communications manually in detail. Examples include tools such as tcpdump and Wireshark, which can be used by security professionals to record network communications through packet captures. Packet captures can then be investigated to identify potentially malicious activity.

## Resources

- If you would like to learn more about network components organizations can monitor, check out [network traffic - MITRE ATT&CK®](https://attack.mitre.org/datasources/DS0029/)
- Attackers can leverage different techniques to exfiltrate data, should you like to learn more, check out [data exfiltration techniques - MITRE ATT&CK®](https://attack.mitre.org/tactics/TA0010/)

# Learn more about packet captures

## Packets

Previously in the program, you learned that a **data packet** is a basic unit of information that travels from one device to another within a network. Detecting network intrusions begins at the packet level. That's because packets form the basis of information exchange over a network. Each time you perform an activity on the internet—like visiting a website—packets are sent and received between your computer and the website’s server. These packets are what help transmit information through a network. For example, when uploading an image to a website, the data gets broken up into multiple packets, which then get routed to the intended destination and reassembled upon delivery.

In cybersecurity, packets provide valuable information that helps add context to events during investigations. Understanding the transfer of information through packets will not only help you develop insight on network activity, it will also help you identify abnormalities and better defend networks from attacks.

Packets contain three components: the header, the payload, and the footer. Here’s a description of each of these components.

### Header

Packets begin with the most essential component: the header. Packets can have several headers depending on the protocols used such as an Ethernet header, an IP header, a TCP header, and more. Headers provide information that’s used to route packets to their destination. This includes information about the source and destination IP addresses, packet length, protocol, packet identification numbers, and more.

Here is an IPv4 header with the information it provides:

![ipv4-header](/google-cybersecurity-professional-certificate/06-sound-the-alarm-detection-and-response/assets/ipv4-header.png)

### Payload

The payload component directly follows the header and contains the actual data being delivered. Think back to the example of uploading an image to a website; the payload of this packet would be the image itself.

### Footer

The footer, also known as the trailer, is located at the end of a packet. The Ethernet protocol uses footers to provide error-checking information to determine if data has been corrupted. In addition, Ethernet network packets that are analyzed might not display footer information due to network configurations.

**Note**: Most protocols, such as the Internet Protocol (IP), do not use footers.

## Network protocol analyzers

**Network protocol analyzers (packet sniffers)** are tools designed to capture and analyze data traffic within a network. Examples of network protocol analyzers include tcpdump, Wireshark, and TShark.

Beyond their use in security as an investigative tool used to monitor networks and identify suspicious activity, network protocol analyzers can be used to collect network statistics, such as bandwidth or speed, and troubleshoot network performance issues, like slowdowns.

Network protocol analyzers can also be used for malicious purposes. For example, malicious actors can use network protocol analyzers to capture packets containing sensitive data, such as account login information.

Here’s a network diagram illustrating how packets get transmitted from a sender to the receiver. A network protocol analyzer is placed in the middle of the communications to capture the data packets that travel over the wire.
Computer A sends data packets to Computer B. The network protocol analyzer is located in the middle of the network’s path.

### How network protocol analyzers work

Network protocol analyzers use both software and hardware capabilities to capture network traffic and display it for security analysts to examine and analyze. Here’s how:

1. First, packets must be collected from the network via the **Network Interface Card (NIC)**, which is hardware that connects computers to a network, like a router. NICs receive and transmit network traffic, but by default they only listen to network traffic that’s addressed to them. To capture all network traffic that is sent over the network, a NIC must be switched to a mode that has access to all visible network data packets. In wireless interfaces this is often referred to as monitoring mode, and in other systems it may be called promiscuous mode. This mode enables the NIC to have access to all visible network data packets, but it won’t help analysts access all packets across a network. A network protocol analyzer must be positioned in an appropriate network segment to access all traffic between different hosts.
2. The network protocol analyzer collects the network traffic in raw binary format. Binary format consists of 0s and 1s and is not as easy for humans to interpret. The network protocol analyzer takes the binary and converts it so that it’s displayed in a human-readable format, so analysts can easily read and understand the information.

**Note**: Enabling promiscuous can expose your device to potential attacks because it allows sensitive information like passwords and other confidential data to be captured. It's important to use tools that operate in promiscuous mode responsibly and with caution.

### Capturing packets

**Packet sniffing** is the practice of capturing and inspecting data packets across a network. A **packet capture (p-cap)** is a file containing data packets intercepted from an interface or network. Packet captures can be viewed and further analyzed using network protocol analyzers. For example, you can filter packet captures to only display information that's most relevant to your investigation, such as packets sent from a specific IP address.

**Note**: Using network protocol analyzers to intercept and examine private network communications without permission is considered illegal in many places.

P-cap files can come in many formats depending on the packet capture library that’s used. Each format has different uses and network tools may use or support specific packet capture file formats by default. You should be familiar with the following libraries and formats:

1. **Libpcap** is a packet capture library designed to be used by Unix-like systems, like Linux and MacOS®. Tools like tcpdump use Libpcap as the default packet capture file format.
2. **WinPcap** is an open-source packet capture library designed for devices running Windows operating systems. It’s considered an older file format and isn’t predominantly used.
3. **Npcap** is a library designed by the port scanning tool Nmap that is commonly used in Windows operating systems.
4. **PCAPng** is a modern file format that can simultaneously capture packets and store data. Its ability to do both explains the “ng,” which stands for “next generation.”

**Pro tip**: Analyzing your home network can be a good way to practice using these tools.

## Resources for more information

This Infosec article describes the risks of [packet crafting](https://www.infosecinstitute.com/resources/hacking/packet-crafting-a-serious-crime/), a technique used to test a network’s structure.

# Investigate packet details

## Internet Protocol (IP)

Packets form the foundation of data exchange over a network, which means that detection begins at the packet level. The **Internet Protocol (IP)** includes a set of standards used for routing and addressing data packets as they travel between devices on a network. IP operates as the foundation for all communications over the internet.

IP ensures that packets reach their destinations. There are two versions of IP that you will find in use today: IPv4 and IPv6. Both versions use different headers to structure packet information.

### IPv4

IPv4 is the most commonly used version of IP. There are thirteen fields in the header:

- **Version**: This field indicates the IP version. For an IPv4 header, IPv4 is used.
- **Internet Header Length (IHL)**: This field specifies the length of the IPv4 header including any Options.
- **Type of Service (ToS)**: This field provides information about packet priority for delivery.
- **Total Length**: This field specifies the total length of the entire IP packet including the header and the data.
- **Identification**: Packets that are too large to send are fragmented into smaller pieces. This field specifies a unique identifier for fragments of an original IP packet so that they can be reassembled once they reach their destination.
- **Flags**: This field provides information about packet fragmentation including whether the original packet has been fragmented and if there are more fragments in transit.
- **Fragment Offset**: This field is used to identify the correct sequence of fragments.
- **Time to Live (TTL)**: This field limits how long a packet can be circulated in a network, preventing packets from being forwarded by routers indefinitely.
- **Protocol**: This field specifies the protocol used for the data portion of the packet.
- **Header Checksum**: This field specifies a checksum value which is used for error-checking the header.
- **Source Address**: This field specifies the source address of the sender.
- **Destination Address**: This field specifies the destination address of the receiver.
- **Options**: This field is optional and can be used to apply security options to a packet.

### IPv6

IPv6 adoption has been increasing because of its large address space. There are eight fields in the header:

- **Version**: This field indicates the IP version. For an IPv6 header, IPv6 is used.
- **Traffic Class**: This field is similar to the IPv4 Type of Service field. The Traffic Class field provides information about the packet's priority or class to help with packet delivery.
- **Flow Label**: This field identifies the packets of a flow. A flow is the sequence of packets sent from a specific source.
- **Payload Length**: This field specifies the length of the data portion of the packet.
- **Next Header**: This field indicates the type of header that follows the IPv6 header such as TCP.
- **Hop Limit**: This field is similar to the IPv4 Time to Live field. The Hop Limit limits how long a packet can travel in a network before being discarded.
- **Source Address**: This field specifies the source address of the sender.
- **Destination Address**: This field specifies the destination address of the receiver.

![ipv6-header](/google-cybersecurity-professional-certificate/06-sound-the-alarm-detection-and-response/assets/ipv6-header.png)

Header fields contain valuable information for investigations and tools like Wireshark help to display these fields in a human-readable format.

## Wireshark

**Wireshark** is an open-source network protocol analyzer. It uses a graphical user interface (GUI), which makes it easier to visualize network communications for packet analysis purposes. Wireshark has many features to explore that are beyond the scope of this course. You'll focus on how to use basic filtering to isolate network packets so that you can find what you need.

### Display filters

Wireshark's display filters let you apply filters to packet capture files. This is helpful when you are inspecting packet captures with large volumes of information. Display filters will help you find specific information that's most relevant to your investigation. You can filter packets based on information such as protocols, IP addresses, ports, and virtually any other property found in a packet. Here, you'll focus on display filtering syntax and filtering for protocols, IP addresses, and ports.

### Comparison operators

You can use different comparison operators to locate specific header fields and values. Comparison operators can be expressed using either abbreviations or symbols. For example, this filter using the `==` equal symbol in this filter `ip.src == 8.8.8.8` is identical to using the `eq` abbreviation in this filter `ip.src eq 8.8.8.8`.

This table summarizes the different types of comparison operators you can use for display filtering.

|      Operator type       | Symbol | Abbreviation |
| :----------------------: | :----: | :----------: |
|          Equal           |   ==   |      eq      |
|        Not equal         |   !=   |      ne      |
|       Greater than       |   >    |      gt      |
|        Less than         |   <    |      lt      |
| Greater than or equal to |   >=   |      ge      |
|  Less than or equal to   |   <=   |      le      |

**Pro tip**: You can combine comparison operators with Boolean logical operators like `and` and `or` to create complex display filters. Parentheses can also be used to group expressions and to prioritize search terms.

### Contains operator

The `contains` operator is used to filter packets that contain an exact match of a string of text. Here is an example of a filter that displays all HTTP streams that match the keyword `"moved"`.

![contains-operator](/google-cybersecurity-professional-certificate/06-sound-the-alarm-detection-and-response/assets/contains-operator.png)

### Matches operator

The `matches` operator is used to filter packets based on the regular expression (regex) that's specified. Regular expression is a sequence of characters that forms a pattern. You'll explore more about regular expressions later in this program.

## Filter toolbar

You can apply filters to a packet capture using Wireshark's filter toolbar. In this example, dns is the applied filter, which means Wireshark will only display packets containing the DNS protocol.

![filter-toolbar](/google-cybersecurity-professional-certificate/06-sound-the-alarm-detection-and-response/assets/filter-toolbar.png)

### Filter for protocols

Protocol filtering is one of the simplest ways you can use display filters. You can simply enter the name of the protocol to filter. For example, to filter for DNS packets simply type `dns` in the filter toolbar. Here is a list of some protocols you can filter for:

- dns
- http
- ftp
- ssh
- arp
- telnet
- icmp

### Filter for an IP address

You can use display filters to locate packets with a specific IP address.

For example, if you would like to filter packets that contain a specific IP address use `ip.addr`, followed by a space, the equal == comparison operator, and the IP address. Here is an example of a display filter that filters for the IP address `172.21.224.2`:

`ip.addr == 172.21.224.2`

To filter for packets originating from a specific source IP address, you can use the `ip.src` filter. Here is an example that looks for the `10.10.10.10` source IP address:

`ip.src == 10.10.10.10`

To filter for packets delivered to a specific destination IP address, you can use the `ip.dst` filter. Here is an example that searches for the `4.4.4.4` destination IP address:

`ip.dst == 4.4.4.4`

### Filter for a MAC address

You can also filter packets according to the **Media Access Control (MAC) address**. As a refresher, a MAC address is a unique alphanumeric identifier that is assigned to each physical device on a network.

Here's an example:

`eth.addr == 00:70:f4:23:18:c4`

### Filter for ports

Port filtering is used to filter packets based on port numbers. This is helpful when you want to isolate specific types of traffic. DNS traffic uses TCP or UDP port 53 so this will list traffic related to DNS queries and responses only.

For example, if you would like to filter for a UDP port:

`udp.port == 53`

Likewise, you can filter for TCP ports as well:

`tcp.port == 25`

## Follow streams

Wireshark provides a feature that lets you filter for packets specific to a protocol and view streams. A stream or conversation is the exchange of data between devices using a protocol. Wireshark reassembles the data that was transferred in the stream in a way that's simple to read.

![follow-streams](/google-cybersecurity-professional-certificate/06-sound-the-alarm-detection-and-response/assets/follow-streams.png)

Following a protocol stream is useful when trying to understand the details of a conversation. For example, you can examine the details of an HTTP conversation to view the content of the exchanged request and response messages.

## Resources

To learn more about Wireshark's full features and capabilities, explore the [Wireshark official user guide](https://www.wireshark.org/docs/wsug_html/).

# Analyze your first packet

## Activity overview

As a security analyst, you’ll need to analyze network traffic in order to learn what type of traffic is being sent to and from systems on the networks you’ll be working with.

Previously, you learned about packet capture and analysis. Analyzing packets can help security teams interpret and understand network communications. Network protocol analyzers such as Wireshark, which has a graphical user interface or GUI, can help you examine packet data during your investigations. Since network packet data is complex, network protocol analyzers (packet sniffers) like Wireshark are designed to help you find patterns and filter the data in order to focus on the network traffic that is most relevant to your security investigations.

Now you’ll use Wireshark to inspect packet data and apply filters to sort through packet information efficiently.

In this lab activity, you’ll use Wireshark to examine a sample packet capture file and filter the network traffic data.

This exemplar is a walkthrough of the previous Qwiklab activity, including detailed instructions and solutions. You may use this exemplar if you were unable to complete the lab and/or you need extra guidance in competing lab tasks. You may also refer to this exemplar to prepare for the graded quiz in this module.

## Scenario

In this scenario, you’re a security analyst investigating traffic to a website.

You’ll analyze a network packet capture file that contains traffic data related to a user connecting to an internet site. The ability to filter network traffic using packet sniffers to gather relevant information is an essential skill as a security analyst.

You must filter the data in order to:

- identify the source and destination IP addresses involved in this web browsing session,
- examine the protocols that are used when the user makes the connection to the website, and
- analyze some of the data packets to identify the type of information sent and received by the systems that connect to each other when the network data is captured.

Here’s how you’ll do this: **First**, you’ll open the packet capture file and explore the basic Wireshark graphic user interface. **Second**, you’ll open a detailed view of a single packet and explore how to examine the various protocol and data layers inside a network packet. **Third**, you’ll apply filters to select and inspect packets based on specific criteria. **Fourth**, you’ll filter and inspect UDP DNS traffic to examine protocol data. **Finally**, you’ll apply filters to TCP packet data to search for specific payload text data.

You’re ready to use Wireshark to inspect network packet data!

## Task 1. Explore data with Wireshark

In this task, you must open a network packet capture file that contains data captured from a system that made web requests to a site. You need to open this data with Wireshark to get an overview of how the data is presented in the application.

1. To open the packet capture file, double-click the sample file on the Windows desktop. This will start Wireshark.

![wireshark-sample-file](/google-cybersecurity-professional-certificate/06-sound-the-alarm-detection-and-response/assets/wireshark-sample-file.png)

The packet capture file has the Wireshark packet capture file icon, which shows a shark's fin swimming above three rows of binary digits. The packet capture file has a `.pcap` file extension that is hidden by default by Windows Explorer and on the desktop view.

**Note**: A **Software Update** dialog box may appear, notifying you that a new version of Wireshark is available. Click **Skip this version**.

2. Double-click the Wireshark title bar next to the `sample.pcap` filename to maximize the Wireshark application window.

![wireshark-sample-pcap](/google-cybersecurity-professional-certificate/06-sound-the-alarm-detection-and-response/assets/wireshark-sample-pcap.png)

A lot of network packet traffic is listed, which is why you’ll apply filters to find the information needed in an upcoming step.

For now, here is an overview of the key property columns listed for each packet:

- **No.**: The index number of the packet in this packet capture file
- **Time**: The timestamp of the packet
- **Source**: The source IP address
- **Destination**: The destination IP address
- **Protocol**: The protocol contained in the packet
- **Length**: The total length of the packet
- **Info**: Some information about the data in the packet (the payload) as interpreted by Wireshark

Not all the data packets are the same color. Coloring rules are used to provide high-level visual cues to help you quickly classify the different types of data. Since network packet capture files can contain large amounts of data, you can use coloring rules to quickly identify the data that is relevant to you. The example packet lists a group of light blue packets that all contain DNS traffic, followed by green packets that contain a mixture of TCP and HTTP protocol traffic.

3. Scroll down the packet list until a packet is listed where the info column starts with the words 'Echo (ping) request'.
   1. What is the protocol of the first packet in the list where the info column starts with the words 'Echo (ping) request'?
   2. **Answer**: ICMP is the protocol type listed for the first (and all) packets that contain 'Echo (ping) request' in the info column.

## Task 2. Apply a basic Wireshark filter and inspect a packet

In this task, you’ll open a packet in Wireshark for more detailed exploration and filter the data to inspect the network layers and protocols contained in the packet.

1. Enter the following filter for traffic associated with a specific IP address. Enter this into the **Apply a display filter...** text box immediately above the list of packets: `ip.addr == 142.250.1.139`
2. Press **ENTER** or click the **Apply display filter** icon in the filter text box.
   1. The list of packets displayed is now significantly reduced and contains only packets where either the source or the destination IP address matches the address you entered. Now only two packet colors are used: **light pink** for `ICMP` protocol packets and **light green** for `TCP` (and `HTTP`, which is a subset of `TCP`) packets.
3. Double-click the first packet that lists `TCP` as the protocol.
   1. This opens a packet details pane window:

![wireshark-packet-details](/google-cybersecurity-professional-certificate/06-sound-the-alarm-detection-and-response/assets/wireshark-packet-details.png)

The upper section of this window contains subtrees where Wireshark will provide you with an analysis of the various parts of the network packet. The lower section of the window contains the raw packet data displayed in hexadecimal and ASCII text. There is also placeholder text for fields where the character data does not apply, as indicated by the dot (“.”).

**Note**: The details pane is located at the bottom portion of the main Wireshark window. It can also be accessed in a new window by double clicking a packet.

4. Double-click the first subtree in the upper section. This starts with the word **Frame**.
   1. This provides you with details about the overall network packet, or frame, including the frame length and the arrival time of the packet. At this level, you’re viewing information about the entire packet of data.
5. Double-click **Frame** again to collapse the subtree and then double-click the **Ethernet II** subtree.
   1. This item contains details about the packet at the Ethernet level, including the source and destination MAC addresses and the type of internal protocol that the Ethernet packet contains.
6. Double-click **Ethernet II** again to collapse that subtree and then double-click the **Internet Protocol Version 4** subtree.
   1. This provides packet data about the Internet Protocol (IP) data contained in the Ethernet packet. It contains information such as the source and destination IP addresses and the Internal Protocol (for example, TCP or UDP), which is carried inside the IP packet.
   2. **Note**: The Internet Protocol Version 4 subtree is Internet Protocol Version 4 (IPv4). The third subtree label reflects the protocol.
   3. The source and destination IP addresses shown here match the source and destination IP addresses in the summary display for this packet in the main Wireshark window.
7. Double-click **Internet Protocol Version 4** again to collapse that subtree and then double-click the **Transmission Control Protocol** subtree.
   1. This provides detailed information about the TCP packet, including the source and destination TCP ports, the TCP sequence numbers, and the TCP flags.
   2. The source port and destination port listed here match the source and destination ports in the info column of the summary display for this packet in the list of all of the packets in the main Wireshark window.
   3. What is the TCP destination port of this TCP packet?
   4. **Answer**: Port 80 is the TCP destination port for this packet. It contains the initial web request to an HTTP website that will typically be listening on TCP port 80.
8. In the **Transmission Control Protocol** subtree, scroll down and double-click **Flags**.
   1. This provides a detailed view of the TCP flags set in this packet.
9. Click the **X** icon to close the detailed packet inspection window.
10. Click the **X Clear display filter** icon in the Wireshark filter bar to clear the IP address filter.

![wireshark-clear-display-filter](/google-cybersecurity-professional-certificate/06-sound-the-alarm-detection-and-response/assets/wireshark-clear-display-filter.png)

All the packets have returned to the display.

If you ever accidentally close the Wireshark application, you can reopen it by double-clicking the **sample** file on the desktop.

## Task 3. Use filters to select packets

In this task, you’ll use filters to analyze specific network packets based on where the packets came from or where they were sent to. You’ll explore how to select packets using either their physical Ethernet Media Access Control (MAC) address or their Internet Protocol (IP) address.

1. Enter the following filter to select traffic for a specific source IP address only. Enter this into the **Apply a display filter...** text box immediately above the list of packets: `ip.src == 142.250.1.139`
2. Press **ENTER** or click the Apply display filter icon in the filter text box. A filtered list is returned with fewer entries than before. It contains only packets that came from **142.250.1.139**.
3. Click the **X Clear display filter** icon in the Wireshark filter bar to clear the IP address filter.
4. Enter the following filter to select traffic for a specific destination IP address only: `ip.dst == 142.250.1.139`
5. Press **ENTER** or click the **Apply display filter** icon in the filter text box. A filtered list is returned that contains only packets that were sent to **142.250.1.139**.
6. Click the **X Clear display filter** icon in the Wireshark filter bar to clear the IP address filter.
7. Enter the following filter to select traffic to or from a specific Ethernet MAC address. This filters traffic related to one MAC address, regardless of the other protocols involved: `eth.addr == 42:01:ac:15:e0:02`
8. Press **ENTER** or click the **Apply display filter** icon in the filter text box.
9. Double-click the first packet in the list. You may need to scroll back to display the first packet in the filtered list.
10. Double-click the **Ethernet II** subtree if it is not already open. The MAC address you specified in the filter is listed as either the source or destination address in the expanded Ethernet II subtree.
11. Double-click the Ethernet II subtree to close it.
12. Double-click the **Internet Protocol Version 4** subtree to expand it and scroll down until the Time to Live and Protocol fields appear. The Protocol field in the Internet Protocol Version 4 subtree indicates which IP internal protocol is contained in the packet.
    1. What is the protocol contained in the Internet Protocol Version 4 subtree from the first packet related to MAC address `42:01:ac:15:e0:02`?
    2. **Answer**: TCP is the internal protocol contained in the first packet from MAC address `42:01:ac:15:e0:02`.
13. Click the X icon to close the detailed packet inspection window.
14. Click the X Clear display filter icon in the Wireshark filter bar to clear the MAC address filter.

## Task 4. Use filters to explore DNS packets

In this task, you’ll use filters to select and examine DNS traffic. Once you‘ve selected sample DNS traffic, you’ll drill down into the protocol to examine how the DNS packet data contains both queries (names of internet sites that are being looked up) and answers (IP addresses that are being sent back by a DNS server when a name is successfully resolved).

1. Enter the following filter to select UDP port **53** traffic. DNS traffic uses UDP port **53**, so this will list traffic related to DNS queries and responses only. Enter this into the **Apply a display filter...** text box immediately above the list of packets: `udp.port == 53`
2. Press **ENTER** or click the **Apply display filter** icon in the filter text box.
3. Double-click the first packet in the list to open the detailed packet window.
4. Scroll down and double-click the **Domain Name System (query)** subtree to expand it.
5. Scroll down and double-click **Queries**. You’ll notice that the name of the website that was queried is `opensource.google.com`.
6. Click the **X** icon to close the detailed packet inspection window.
7. Double-click the fourth packet in the list to open the detailed packet window.
8. Scroll down and double-click the **Domain Name System (query)** subtree to expand it.
9. Scroll down and double-click **Answers**, which is in the **Domain Name System (query)** subtree.
   1. The Answers data includes the name that was queried (`opensource.google.com`) and the addresses that are associated with that name.
   2. Which of these IP addresses is displayed in the expanded Answers section for the DNS query for `opensource.google.com`?
   3. **Answer**: The IP address 142.250.1.139 is displayed in the expanded Answers section for the DNS query for `opensource.google.com`.
10. Click the **X** icon to close the detailed packet inspection window.
11. Click the **X Clear display filter** icon in the Wireshark filter bar to clear the filter.

## Task 5. Use filters to explore TCP packets

In this task, you’ll use additional filters to select and examine TCP packets. You’ll learn how to search for text that is present in payload data contained inside network packets. This will locate packets based on something such as a name or some other text that is of interest to you.

1. Enter the following filter to select TCP port **80** traffic. TCP port **80** is the default port that is associated with web traffic: `tcp.port == 80`
2. Press **ENTER** or click the **Apply display filter** icon in the filter text box.
   1. Quite a few packets were created when the user accessed the web page `http://opensource.google.com`.
3. Double-click the first packet in the list. The **Destination** IP address of this packet is `169.254.169.254`.
   1. What is the Time to Live value of the packet as specified in the Internet Protocol Version 4 subtree?
   2. `Answer`: The Time to Live value is 64. This property is contained in the Internet Protocol Version 4 subtree, which is the third subtree listed in the detailed packet inspection window.
   3. What is the Frame Length of the packet as specified in the Frame subtree?
   4. `Answer`: The Frame Length is 54 bytes. This property is contained in the Frame subtree, which is the first subtree listed in the detailed packet inspection window.
   5. What is the Header Length of the packet as specified in the Internet Protocol Version 4 subtree?
   6. `Answer`: The Header Length is 20 bytes. This property is defined in the Internet Protocol Version 4 subtree, which is the fourth subtree listed in the detailed packet inspection window.
   7. What is the Destination Address as specified in the Internet Protocol Version 4 subtree?
   8. `Answer`: The Destination Address is 169.254.169.254. This property is defined in the Internet Protocol Version 4 subtree, which is the third subtree listed in the detailed packet inspection window.
4. Click the **X** icon to close the detailed packet inspection window.
5. Click the **X Clear display filter** icon in the Wireshark filter bar to clear the filter.
6. Enter the following filter to select TCP packet data that contains specific text data. `tcp contains "curl"`
7. Press ENTER or click the Apply display filter icon in the filter text box.
   1. This filters to packets containing web requests made with the curl command in this sample packet capture file.

# Overview of tcpdump

## What is tcpdump?

**Tcpdump** is a command-line network protocol analyzer. Recall that a **command-line interface (CLI)** is a text-based user interface that uses commands to interact with the computer.

Tcpdump is used to capture network traffic. This traffic can be saved to a **packet capture (p-cap)**, which is a file containing data packets intercepted from an interface or network. The p-cap file can be accessed, analyzed, or shared at a later time. Analysts use tcpdump for a variety of reasons, from troubleshooting network issues to identifying malicious activity. Tcpdump comes pre-installed in many Linux distributions and can also be installed on other Unix-based operating systems such as macOS®.

**Note**: It's common for network traffic to be encrypted, which means data is encoded and unreadable. Inspecting the network packets might require decrypting the data using the appropriate private keys.

## Capturing packets with tcpdump

Previously in this program, you learned that a Linux **root user (or superuser)** has elevated privileges to modify the system. You also learned that the sudo command temporarily grants elevated permissions to specific users in Linux. Like many other packet sniffing tools, you’ll need to have administrator-level privileges to capture network traffic using tcpdump. This means you will need to either be logged in as the root user or have the ability to use the sudo command. Here is a breakdown of the tcpdump syntax for capturing packets:

`sudo tcpdump [-i interface] [option(s)] [expression(s)]`

- The `sudo tcpdump` command begins running tcpdump using elevated permissions as sudo.
- The `-i` parameter specifies the network interface to capture network traffic. You must specify a network interface to capture from to begin capturing packets. For example, if you specify `-i any` you’ll sniff traffic from all network interfaces on the system.
- The `option(s)` are optional and provide you with the ability to alter the execution of the command. The `expression(s)` are a way to further filter network traffic packets so that you can isolate network traffic. You’ll learn more about `option(s)` and `expression(s)` in the next section.

**Note**: Before you can begin capturing network traffic, you must identify which network interface you'll want to use to capture packets from. You can use the `-D` flag to list the network interfaces available on a system.

## Options

With tcpdump, you can apply options, also known as flags, to the end of commands to filter network traffic. Short options are abbreviated and represented by a hyphen and a single character like -i. Long options are spelled out using a double hyphen like `--interface`. Tcpdump has over fifty options that you can explore using the [manual page](https://www.tcpdump.org/manpages/tcpdump.1.html). Here, you’ll examine a couple of essential tcpdump options including how to write and read packet capture files.

**Note**: Options are case sensitive. For example, a lowercase `-w` is a separate option with a different use than the option with an uppercase `-W`.

**Note**: tcpdump options that are written using short options can be written with or without a space between the option and its value. For example, `sudo tcpdump -i any -c 3` and `sudo tcpdump -iany -c3` are equivalent commands.

### `-w`

Using the `-w` flag, you can write or save the sniffed network packets to a packet capture file instead of just printing it out in the terminal. This is very useful because you can refer to this saved file for later analysis. In this command, tcpdump is capturing network traffic from all network interfaces and saving it to a packet capture file named `packetcapture.pcap`:

`sudo tcpdump -i any -w packetcapture.pcap`

### `-r`

Using the `-r` flag, you can read a packet capture file by specifying the file name as a parameter. Here is an example of a tcpdump command that reads a file called `packetcapture.pcap`:

`sudo tcpdump -r packetcapture.pcap`

### `-v`

As you’ve learned, packets contain a lot of information. By default, tcpdump will not print out all of a packet's information. This option, which stands for verbose, lets you control how much packet information you want tcpdump to print out.

There are three levels of verbosity you can use depending on how much packet information you want tcpdump to print out. The levels are `-v`, `-vv`, and `-vvv`. The level of verbosity increases with each added v. The verbose option can be helpful if you’re looking for packet information like the details of a packet’s IP header fields. Here’s an example of a tcpdump command that reads the `packetcapture.pcap` file with verbosity:

`sudo tcpdump -r packetcapture.pcap -v`

### `-c`

The `-c` option stands for count. This option lets you control how many packets tcpdump will capture. For example, specifying `-c 1` will only print out one single packet, whereas `-c 10` prints out 10 packets. This example is telling tcpdump to only capture the first three packets it sniffs from `any` network interface:

`sudo tcpdump -i any -c 3`

### `-n`

By default, tcpdump will perform name resolution. This means that tcpdump automatically converts IP addresses to names. It will also resolve ports to commonly associated services that use these ports. This can be problematic because tcpdump isn’t always accurate in name resolution. For example, tcpdump can capture traffic from port 80 and automatically translates port 80 to HTTP in the output. However, this is misleading because port 80 isn’t always going to be using HTTP; it could be using a different protocol.

Additionally, name resolution uses what’s known as a reverse DNS lookup. A reverse DNS lookup is a query that looks for the domain name associated with an IP address. If you perform a reverse DNS lookup on an attacker’s system, they might be alerted that you are investigating them through their DNS records.

Using the `-n` flag disables this automatic mapping of numbers to names and is considered to be best practice when sniffing or analyzing traffic. Using `-n` will not resolve hostnames, whereas `-nn` will not resolve both hostnames or ports. Here’s an example of a tcpdump command that reads the `packetcapture.pcap` file with verbosity and disables name resolution:

`sudo tcpdump -r packetcapture.pcap -v -n`

**Pro tip**: You can combine options together. For example, `-v` and `-n` can be combined as `-vn`. But, if an option accepts a parameter right after it like `-c 1` or `-r capture.pcap` then you can’t combine other options to it.

## Expressions

Using filter expressions in tcpdump commands is also optional, but knowing how and when to use filter expressions can be helpful during packet analysis. There are many ways to use filter expressions.

If you want to specifically search for network traffic by protocol, you can use filter expressions to isolate network packets. For example, you can filter to find only IPv6 traffic using the filter expression `ip6`.

You can also use boolean operators like `and`, `or`, or `not` to further filter network traffic for specific IP addresses, ports, and more. The example below reads the `packetcapture.pcap` file and combines two expressions `ip and port 80` using the `and` boolean operator:

`sudo tcpdump -r packetcapture.pcap -n 'ip and port 80'`

**Pro tip**: You can use single or double quotes to ensure that tcpdump executes all of the expressions. You can also use parentheses to group and prioritize different expressions. Grouping expressions is helpful for complex or lengthy commands. For example, the command `ip and (port 80 or port 443)` tells tcpdump to prioritize executing the filters enclosed in the parentheses before filtering for IPv4.

## Interpreting output

Once you run a command to capture packets, tcpdump will print the output of the command as the sniffed packets. In the output, tcpdump prints one line of text for each packet with each line beginning with a timestamp. Here’s an example of a command and output for a single TCP packet:

`sudo tcpdump -i any -v -c 1`

This command tells tcpdump to capture packets on `-i any` network interface. The option `-v` prints out the packet with detailed information and the option `-c 1` prints out only one packet. Here is the output of this command:

![tcpdump-interpreting-output](/google-cybersecurity-professional-certificate/06-sound-the-alarm-detection-and-response/assets/tcpdump-interpreting-output.png)

1. **Timestamp**: The output begins with the timestamp, which starts with hours, minutes, seconds, and fractions of a second.
2. **Source IP**: The packet’s origin is provided by its source IP address.
3. **Source port**: This port number is where the packet originated.
4. **Destination IP**: The destination IP address is where the packet is being transmitted to.
5. **Destination port**: This port number is where the packet is being transmitted to.

The remaining output contains details of the TCP connection including flags and sequence number. The `options` information is additional packet information that the `-v` option has provided.

## Resources for more information

- Learn more with tcpdump's [tutorials and guides](https://www.tcpdump.org/), which includes additional educational resources.
- Learn more about using expressions to filter traffic with this [tcpdump tutorial by Daniel Miessler](https://danielmiessler.com/blog/tcpdump).

# Capture your first packet

## Activity overview

As a security analyst, it’s important to know how to capture and filter network traffic in a Linux environment. You’ll also need to know the basic concepts associated with network interfaces.

In this lab activity, you’ll perform tasks associated with using tcpdump to capture network traffic. You’ll capture the data in a packet capture (p-cap) file and then examine the contents of the captured packet data to focus on specific types of traffic.

Let’s capture network traffic!

This exemplar is a walkthrough of the previous Qwiklab activity, including detailed instructions and solutions. You may use this exemplar if you were unable to complete the lab and/or you need extra guidance in competing lab tasks. You may also refer to this exemplar to prepare for the graded quiz in this module.

## Scenario

You’re a network analyst who needs to use `tcpdump` to capture and analyze live network traffic from a Linux virtual machine.

The lab starts with your user account, called `analyst`, already logged in to a Linux terminal.

Your Linux user's home directory contains a sample packet capture file that you will use at the end of the lab to answer a few questions about the network traffic that it contains.

Here’s how you’ll do this: **First**, you’ll identify network interfaces to capture network packet data. **Second**, you’ll use `tcpdump` to filter live network traffic. **Third**, you’ll capture network traffic using `tcpdump`. **Finally**, you’ll filter the captured packet data.

## Task 1. Identify network interfaces

In this task, you must identify the network interfaces that can be used to capture network packet data.

1. Use ifconfig to identify the interfaces that are available: `sudo ifconfig`
   1. This command returns output similar to the following:

```sh
eth0: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1460
        inet 172.17.0.2  netmask 255.255.0.0  broadcast 172.17.255.255
        ether 02:42:ac:11:00:02  txqueuelen 0  (Ethernet)
        RX packets 784  bytes9379957 (8.9 MiB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 683  bytes 56880 (55.5 KiB)
        TX errors 0  dropped 0 overruns 0  carrier 0 collisions 0

lo: flags=73<UP,LOOPBACK,RUNNING>  mtu 65536
        inet 127.0.0.1  netmask 255.0.0.0
        loop  txqueuelen 1000  (Local Loopback)
        RX packets 400  bytes 42122 (041.1 KiB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 400  bytes 42122 (041.1 KiB)
        TX errors 0  dropped 0 overruns 0  carrier 0 collisions 0
```

The Ethernet network interface is identified by the entry with the eth prefix.

So, in this lab, you'll use `eth0` as the interface that you will capture network packet data from in the following tasks.

2. Use `tcpdump` to identify the interface options available for packet capture: `sudo tcpdump -D`
   1. This command will also allow you to identify which network interfaces are available. This may be useful on systems that do not include the **ifconfig** command.

## Task 2. Inspect the network traffic of a network interface with tcpdump

In this task, you must use `tcpdump` to filter live network packet traffic on an interface.

- Filter live network packet data from the `eth0` interface with `tcpdump`: `sudo tcpdump -i eth0 -v -c5`

This command will run `tcpdump` with the following options:

- `-i eth0`: Capture data specifically from the eth0 interface.
- `-v`: Display detailed packet data.
- `-c5`: Capture 5 packets of data.

Now, let's take a detailed look at the packet information that this command has returned.

Some of your packet traffic data will be similar to the following:

```sh
tcpdump: listening on eth0, link-type EN10MB (Ethernet), capture size 262144 bytes
10:57:33.427749 IP (tos 0x0, ttl 64, id 35057, offset 0, flags [DF], protot TCP (6), length 134)
  7acb26dc1f44.5000 > nginx-us-east1-c.c.qwiklabs-terminal-vms-prod-00.internal.59788: Flags [P.], cksum 0x5851 (incorrect > 0x30d3), seq 1080713945:1080714027, ack 62760789, win 501, options [nop,nop,TS val 1017464119 ecr 3001513453], length 82
10:57:33.427954 IP (tos 0x0, ttl 64, id 21812, offset 0, flags [DF], protot TCP (6), length 52)
  nginx-us-east1-c.c.qwiklabs-terminal-vms-prod-00.internal.59788 > 7acb26dc1f44.5000: Flags [.], cksum 0x9122 (correct), ack 82, win 510, options [nop,nop,TS val 3001513453 ecr 1017464119], length 0
2 packets captured
4 packets received by filter
0 packets dropped by kernel
```

The specific packet data in your lab may be in a different order and may even be for entirely different types of network traffic. The specific details, such as system names, ports, and checksums, will definitely be different. You can run this command again to get different snapshots to outline how data changes between packets.

### Exploring network packet details

In this example, you’ll identify some of the properties that `tcpdump` outputs for the packet capture data you’ve just seen.

1. In the example data at the start of the packet output, `tcpdump` reported that it was listening on the `eth0` interface, and it provided information on the link type and the capture size in bytes: `tcpdump: listening on eth0, link-type EN10MB (Ethernet), capture size 262144 bytes`
2. On the next line, the first field is the packet's timestamp, followed by the protocol type, IP: `22:24:18.910372 IP`
3. The verbose option, `-v`, has provided more details about the IP packet fields, such as TOS, TTL, offset, flags, internal protocol type (in this case, TCP (6)), and the length of the outer IP packet in bytes: `(tos 0x0, ttl 64, id 5802, offset 0, flags [DF], proto TCP (6), length 134)`
   1. The specific details about these fields are beyond the scope of this lab. But you should know that these are properties that relate to the IP network packet.
4. In the next section, the data shows the systems that are communicating with each other: `7acb26dc1f44.5000 > nginx-us-east1-c.c.qwiklabs-terminal-vms-prod-00.internal.59788:`
   1. By default, `tcpdump` will convert IP addresses into names, as in the screenshot. The name of your Linux virtual machine, also included in the command prompt, appears here as the source for one packet and the destination for the second packet. In your live data, the name will be a different set of letters and numbers.
   2. The direction of the arrow (>) indicates the direction of the traffic flow in this packet. Each system name includes a suffix with the port number (.5000 in the screenshot), which is used by the source and the destination systems for this packet.
5. The remaining data filters the header data for the inner TCP packet: `Flags [P.], cksum 0x5851 (incorrect > 0x30d3), seq 1080713945:1080714027, ack 62760789, win 501, options [nop,nop,TS val 1017464119 ecr 3001513453], length 82`
   1. The flags field identifies TCP flags. In this case, the P represents the push flag and the period indicates it's an ACK flag. This means the packet is pushing out data.
   2. The next field is the TCP checksum value, which is used for detecting errors in the data.
   3. This section also includes the sequence and acknowledgment numbers, the window size, and the length of the inner TCP packet in bytes.

## Task 3. Capture network traffic with tcpdump

In this task, you will use `tcpdump` to save the captured network data to a packet capture file.

In the previous command, you used `tcpdump` to stream all network traffic. Here, you will use a filter and other `tcpdump` configuration options to save a small sample that contains only web (TCP port 80) network packet data.

1. Capture packet data into a file called `capture.pcap`: `sudo tcpdump -i eth0 -nn -c9 port 80 -w capture.pcap &`
   1. You must press the **ENTER** key to get your command prompt back after running this command.
   2. This command will run tcpdump in the background with the following options:
      1. `-i eth0`: Capture data from the eth0 interface.
      2. `-nn`: Do not attempt to resolve IP addresses or ports to names.This is best practice from a security perspective, as the lookup data may not be valid. It also prevents malicious actors from being alerted to an investigation.
      3. `-c9`: Capture 9 packets of data and then exit.
      4. `port 80`: Filter only port 80 traffic. This is the default HTTP port.
      5. `-w capture.pcap`: Save the captured data to the named file.
      6. `&`: This is an instruction to the Bash shell to run the command in the background.
   3. This command runs in the background, but some output text will appear in your terminal. The text will not affect the commands when you follow the steps for the rest of the lab.
2. Use curl to generate some HTTP (port 80) traffic: `curl opensource.google.com`
   1. When the curl command is used like this to open a website, it generates some HTTP (TCP port 80) traffic that can be captured.
3. Verify that packet data has been captured: `ls -l capture.pcap`
   1. **Note**: The "Done" in the output indicates that the packet was captured.

## Task 4. Filter the captured packet data

In this task, use `tcpdump` to filter data from the packet capture file you saved previously.

1. Use the tcpdump command to filter the packet header data from the capture.pcap capture file: `sudo tcpdump -nn -r capture.pcap -v`
   1. This command will run tcpdump with the following options:
      1. `-nn`: Disable port and protocol name lookup.
      2. `-r`: Read capture data from the named file.
      3. `-v`: Display detailed packet data.
   2. You must specify the `-nn` switch again here, as you want to make sure `tcpdump` does not perform name lookups of either IP addresses or ports, since this can alert threat actors.
   3. This returns output data similar to the following:

```sh
reading from file capture.pcap, link-type EN10MB (Ethernet)
20:53:27.669101 IP (tos 0x0, ttl 64, id 50874, offset 0, flags [DF], proto TCP (6), length 60)
    172.17.0.2:46498 > 146.75.38.132:80: Flags [S], cksum 0x5445 (incorrect), seq 4197622953, win 65320, options [mss 1420,sackOK,TS val 610940466 ecr 0, nop,wscale 7], length 0
20:53:27.669422 IP (tos 0x0, ttl 62, id 0, offset 0, flags [DF], proto TCP (6), length 60)
    146.75.38.132:80: > 172.17.0.2:46498: Flags [S.], cksum 0xc272 (correct), seq 2026312556, ack 4197622953, win 65535, options [mss 1420,sackOK,TS val 155704241 ecr 610940466, nop,wscale 9], length 0
```

As in the previous example, you can see the IP packet information along with information about the data that the packet contains.

2. Use the `tcpdump` command to filter the extended packet data from the `capture.pcap` capture file: `sudo tcpdump -nn -r capture.pcap -X`
   1. This command will run `tcpdump` with the following options:
      1. `-nn`: Disable port and protocol name lookup.
      2. `-r`: Read capture data from the named file.
      3. `-X`: Display the hexadecimal and ASCII output format packet data. Security analysts can analyze hexadecimal and ASCII output to detect patterns or anomalies during malware analysis or forensic analysis.
   2. **Note**: Hexadecimal, also known as hex or base 16, uses 16 symbols to represent values, including the digits 0-9 and letters A, B, C, D, E, and F. American Standard Code for Information Interchange (ASCII) is a character encoding standard that uses a set of characters to represent text in digital form.

## Test your understanding

- To test your ability to capture and view network data, answer the multiple-choice questions.
  - **Answer**: Use the `sudo tcpdump -c3 -i any -v`.
  - What does the -i option indicate?
    - The `-i` option indicates the network interface to monitor.
  - What type of information does the -v option include?
    - **Answer**: The `-v` option provides verbose information.
  - What tcpdump command can you use to identify the interfaces that are available to perform a packet capture on?
    - **Answer**: Use the `sudo tcpdump -D` command.

# Research network protocol analyzers

## Activity Overview

In this activity, you'll focus on the two network protocol analyzers: Wireshark and tcpdump. Your goal is to gain a basic understanding of the Wireshark and tcpdump, how they work, and what their features are.

As you've learned, a **network protocol analyzer (packet sniffer)** is a tool designed to capture and analyze data traffic within a network. Network protocol analyzers help security analysts examine and understand the network traffic flows.

Be sure to complete this activity before moving on. The next course item will provide you with a completed exemplar to compare to your own work.

## Scenario

Review the following scenario. Then complete the step-by-step instructions.

In your role as a cybersecurity analyst, you have been asked to research the differences and similarities between Wireshark and tcpdump and create a chart that outlines your findings.

## Step-By-Step Instructions

Follow the instructions and answer the question to complete the activity. Then, go to the next course item to compare your work to a completed exemplar.

### Step 1: Access the template

To use the template for this course item, click the link and select Use Template.

Link to template: [Diagram template](https://docs.google.com/presentation/d/1ouKZ4YVI9IKrIEGEz5A-A2fwcKsLYxZRqtOT1d9D-Lc/template/preview?resourcekey=0-5nQZnN18beQMlTyXERtt0A)

### Step 2: Conduct online research

To begin, conduct online research to learn more about tcpdump and Wireshark. You can begin by using the official Wireshark documentation and tcpdump documentation:

- [tcpdump - Resources and documentation](https://www.tcpdump.org/index.html#documentation)
- [Wireshark - Official user guide](https://www.wireshark.org/docs/wsug_html/)

You can also perform an internet search to find resources that explain how these tools work. Try searching for information using these terms:

- Wireshark features and functionalities
- tcpdump features and functionalities
- comparison between tcpdump and Wireshark

Be sure to critically evaluate the search results and select reliable and authoritative sources such as official documentation, reputable cybersecurity websites, or technical forums that provide accurate and factual information about the tools.

Explore these resources to gather information on tcpdump and Wireshark and focus on understanding the different features and functionalities that each tool has.

Consider these questions to help you compare the two tools:

- What software or equipment is required to access and use the tool? Is the tool open-source or proprietary?
- What type of user interface or layout does the tool use?
- How do security analysts typically use the tool? What are the recommended usage scenarios for each tool?
- How does the tool handle capturing, analyzing, and filtering network traffic?
- Are there any limitations or considerations for using this tool?

### Step 3: Fill in the diagram

After you've completed your research on Wireshark and tcpdump, fill out the template and include at least two features for each tool. These could be related to the tool's capabilities, the type of analysis they perform, contrasting features, user interfaces, usage scenarios, and any other notable distinctions. Then, include three similarities between tcpdump and Wireshark.

### Pro Tip: Save the template

Finally, be sure to save a blank copy of the template you used to complete this activity. You can use it for further practice or in your professional projects. These templates will help you work through your thought processes and demonstrate your experience to potential employers.

### What to Include in Your Response

Be sure to address the following elements in your completed activity:

- **At least 2 differences** between Wireshark and tcpdump
- **At least 3 similarities** between Wireshark and tcpdump

## Activity Exemplar

To review the exemplar for this course item, click the link and select Use Template.

Link to exemplar: [Completed diagram](https://docs.google.com/presentation/d/1604PvkOVr3JEfsZImpwVF7h6cC0H22Ye9wj7XvmFd2A/template/preview?resourcekey=0-qEGMtqUFdmOsSLO-13pA3w)

Compare the exemplar to your completed activity. Review your work using each of the criteria in the exemplar. What did you do well? Where can you improve? Use your answers to these questions to guide you as you continue to progress through the course.

**Note**: The exemplar represents one possible way to complete the activity. Yours will likely differ in certain ways. What’s important is that your activity provides your research findings about Wireshark and tcpdump.

# Quiz: Module 2 Challenge

## Questions Set 1

1. Fill in the blank: **\_** describes the amount of data that moves across a network.
   1. Network data
   2. Data exfiltration
   3. Traffic flow
   4. Network traffic
2. What tactic do malicious actors use to maintain and expand unauthorized access into a network?
   1. Phishing
   2. Lateral movement
   3. Data size reduction
   4. Exfiltration
3. What information do packet headers contain? Select three answers.
   1. Payload data
   2. IP addresses
   3. Ports
   4. Protocols
4. Do packet capture files provide detailed snapshots of network communications?
   1. Yes. Packet capture files provide information about network data packets that were intercepted from a network interface.
   2. No. Packet capture files do not contain detailed information about network data packets.
   3. Maybe. The amount of detailed information packet captures contain depends on the type of network interface that is used.
5. Fill in the blank: tcpdump is a network protocol analyzer that uses a(n) **\_** interface.
   1. Linux
   2. graphical user
   3. internet
   4. command-line
6. Which protocol version is considered the foundation for all internet communications?
   1. `ICMP`
   2. `HTTP`
   3. `UDP`
   4. `IPv4`
7. Which IPv4 field determines how long a packet can travel before it gets dropped?
   1. Type of Service
   2. Header Checksum
   3. Options
   4. Time to Live
8. Which IPv4 field uses a value to represent a standard, like TCP?
   1. Version
   2. Total Length
   3. Protocol
   4. Type of Service
9. Which tcpdump option applies verbosity?
   1. `-c`
   2. `-i`
   3. `-n`
   4. `-v`
10. Examine the following tcpdump output: `22:00:19.538395 IP (tos 0x10, ttl 64, id 33842, offset 0, flags [P], proto TCP (6), length 196) 198.168.105.1.41012 > 198.111.123.1.61012: Flags [P.], cksum 0x50af (correct), seq 169, ack 187, win 501, length 42` Which protocols are being used? Select two answers.
    1. `TOS`
    2. `UDP`
    3. `TCP`
    4. `IP`

## Answers Set 1

1. 4
2. 2
3. 2, 3 & 4
4. 1
5. 4
6. 4
7. 4
8. 3
9. 4
10. 3 & 4

## Questions Set 2

1. What type of attack involves the unauthorized transmission of data from a system?
   1. Packet classification
   2. Data leak
   3. Packet crafting
   4. Data exfiltration
2. What tactic do malicious actors use to maintain and expand unauthorized access into a network?
   1. Exfiltration
   2. Data size reduction
   3. Phishing
   4. Lateral movement
3. What information do packet headers contain? Select three answers.
   1. Ports
   2. IP addresses
   3. Protocols
   4. Payload data
4. The practice of capturing and inspecting network data packets that are transmitted across a network is known as **\_**.
   1. port sniffing
   2. protocol capture
   3. packet capture
   4. packet sniffing
5. Network protocol analyzer tools are available to be used with which of the following? Select two answers.
   1. Graphical user interface
   2. Network interface card
   3. Internet protocol
   4. Command-line interface
6. Which layer of the TCP/IP model is responsible for accepting and delivering packets in a network?
   1. Internet
   2. Application
   3. Network Access
   4. Transport
7. What is used to determine whether errors have occurred in the IPv4 header?
   1. Checksum
   2. Protocol
   3. Header
   4. Flags
8. What is the process of breaking down packets known as?
   1. Fragment Offset
   2. Checksum
   3. Flags
   4. Fragmentation
9. Which tcpdump option is used to specify the capture of 5 packets?
   1. `-v 5`
   2. `-i 5`
   3. `-c 5`
   4. `-n 5`
10. Examine the following tcpdump output: `22:00:19.538395 IP (tos 0x10, ttl 64, id 33842, offset 0, flags [P], proto TCP (6), length 196) 198.168.105.1.41012 > 198.111.123.1.61012: Flags [P.], cksum 0x50af (correct), seq 169, ack 187, win 501, length 42` Which protocols are being used? Select two answers.
    1. `TOS`
    2. `UDP`
    3. `TCP`
    4. `IP`

## Answers Set 2

1. 4
2. 4
3. 1, 2 & 3
4. 4
5. 1 & 4
6. 1
7. 1
8. 4
9. 3
10. 2 & 3
